define(function (require, exports, module) {var c=/\+?\$(\w+\-?\w?)\+?/g;var l=/\b(\d*\.?\d+)+(px|dp|vm|vw|vh)\b/ig;var n=/\((.*)?\)/g;var f=/\burl\((.*)?\)/ig;var h=/\<(.*)\>/ig;var e=/\((.*)\)/;var o=/\/\*[\s\S]*?\*\//g;var k=/([^\:]+):([^\;]*);/;var m=/(\/\*[\s\S]*?\*\/)|([^\s\;\{\}][^\;\{\}]*(?=\{))|(\})|([^\;\{\}]+\;(?!\s*\*\/))/gmi;var d=1;var p=2;var b=3;var q=4;var j=function(s){return typeof s=="undefined"||s.length==0||s==null};var i=function(s){if(!(this instanceof i)){return new i(s)}this.init();s&&this.setup(s)};i.prototype={init:function(){this.global={}},setup:function(s){this.config=s||{root:"modules/",uri:"modules/"};this.variable={attributes:{},children:{}};this.wrap=s.wrap?s.wrap+" ":""},clear:function(){this.global={};this.variable={attributes:{},children:{}}},render:function(y,t,v){var x="";if(!y){throw"IOING ERROR { module "+t+" css source is null }"}for(var w=0,s=y.length;w<s;w++){var u=y[w];x+=this.compile(t[u],v[u])}return x},compile:function(t,s){this.id=t;return this.toCSS(this.data=this.toJSON(s))},toJSON:function(v,C){var w={children:{},attributes:{}};var z=null;var A=0;if(typeof C=="undefined"){var C={ordered:false,comments:false,stripComments:false,split:false}}if(C.stripComments){C.comments=false;v=v.replace(o,"")}while((z=m.exec(v))!=null){if(!j(z[d])&&C.comments){var H=z[d].trim();w[A++]=H}else{if(!j(z[p])){var s=z[p].trim();var F=this.toJSON(v,C);if(C.ordered){var y={};y["name"]=s;y["value"]=F;y["type"]="rule";w[A++]=y}else{if(C.split){var G=s.split(",")}else{var G=[s]}for(var x in G){var t=G[x].trim();if(t in w.children){for(var D in F.attributes){w.children[t].attributes[D]=F.attributes[D]}}else{w.children[t]=F}}}}else{if(!j(z[b])){return w}else{if(!j(z[q])){var I=z[q].trim();var B=k.exec(I);if(B){var s=B[1].trim();var E=B[2].trim();if(C.ordered){var y={};y["name"]=s;y["value"]=E;y["type"]="attr";w[A++]=y}else{if(s in w.attributes){var u=w.attributes[s];if(!(u instanceof Array)){w.attributes[s]=[u]}w.attributes[s].push(E)}else{w.attributes[s]=E}}}else{w[A++]=I}}}}}}return w},toCSS:function(t,w,A,y){var s="";if(typeof w=="undefined"){w=0}if(typeof A=="undefined"){A=false}if(typeof y=="undefined"){y=false}if(t.attributes){for(v in t.attributes){var z=t.attributes[v];if(z instanceof Array){for(var u=0;u<z.length;u++){s+=this._setAttr(v,z[u],w,A)}}else{s+=this._setAttr(v,z,w,A)}}}if(t.children){var x=true;for(var v in t.children){if(y&&!x){s+="\n"}else{x=false}s+=this._setNode(v,t.children[v],w,A)}}return s},_getVariable:function(w,u){var t=this.config;var v=this.global;var s=this.variable;return w.replace(c,function(y,x){var z;if(u&&s.children[u]){z=s.children[u].getValueByString(x)}if(z){return z}return s.attributes.getValueByString(x)||v.getValueByString(x)||t.data.getValueByString(x)})},_setAttr:function(s,B,w,C){var y=this;var t=this.id;var v=this.config;B=this._getVariable(B,C);s=device.feat.prefixStyle(s,true);B=(B.indexOf("<")!=-1?B.replace(h,function(E,D){D=v.data.getValueByString(D.replace(l,function(F,H,G){return H*(Unit[G]||1)}));return typeof D=="number"?D+"px":D}):B).replace(l,function(D,F,E){return F*(Unit[E]||1)+"px"});switch(s){case"background-image":case"border-image":case"background":case"content":case"src":B=B.indexOf("url(")!=-1?B.replace(f,function(E,D){D=D.removeQuotes();if(D.indexOf("://")>0){}else{if(D.indexOf("/")==0){D=v.root+D.substr(1)}else{if(D.indexOf("./")==0){D=v.root+t+D.substr(1)}else{if(D.indexOf("-/")==0){D=v.root+v.module+D.substr(1)}else{D=v.root+t+"/"+D}}}}return"url('"+D+"')"}):B;break;case"@extend":var x=this.data.children;var z=C?(x["@section ("+C+")"]||x["@section("+C+")"]).children[B]||x[B]:x[B];if(z){var u="",A=z.attributes;for(s in A){u+="\t".repeat(w)+s+": "+A[s]+";\n"}return u}break}return"\t".repeat(w)+s+": "+B+";\n"},_setNode:function(s,C,y,E){var u="",t=this.wrap,A,E,z,B,w;if(y==0&&s.indexOf("@section")==0){E=e.exec(s);E=E?E[1]:"section:error"}else{if(y==0&&s.indexOf("@global")==0){w=C.attributes;for(var D in w){this.global[D]=w[D]}}else{if((y==0||E)&&s.indexOf("@var")==0){w=C.attributes;for(var D in w){if(E){if(!this.variable.children[E]){this.variable.children[E]={}}this.variable.children[E][D]=w[D]}else{this.variable.attributes[D]=w[D]}}}else{if((y==0||E)&&s.indexOf("@if")==0){if(!seval(this._getVariable(n.exec(s)[1],E))){delete C.children}}}}}if(s.indexOf("@")==0){t="";A=s.split(" ");switch(A[0]){case"@keyframes":s="@"+device.feat.keyframesPrefix+"keyframes "+A[1];break}}if(E){z=y>0;B=y==0;A=s.split(",");s="";for(var x=0,v=A.length;x<v;x++){s+=t+E+" "+A[x]+(x==v-1?"":", ")}}else{s=t+s}u+=B?"":(z?"":"\t".repeat(y))+s+" {\n";u+=this.toCSS(C,y+1,E);u+=B?"":(z?"":"\t".repeat(y))+"}\n";return u}};return i});